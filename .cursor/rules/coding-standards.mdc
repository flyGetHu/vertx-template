---
description:
globs: *.java
alwaysApply: false
---
---
description: "Vert.xé¡¹ç›®Javaç¼–ç è§„èŒƒ - å®šä¹‰å˜é‡å£°æ˜ã€æ–¹æ³•è®¾è®¡ã€å¼‚å¸¸å¤„ç†ã€è·¯ç”±æ§åˆ¶å™¨ç­‰ç¼–ç æ ‡å‡†"
auto_attachments:
  - "**/*.java"
  - "pom.xml"
---

# Vert.x é¡¹ç›®ç¼–ç æ ‡å‡†

## ğŸ“‹ æ ¸å¿ƒç¼–ç åŸåˆ™

### å˜é‡å£°æ˜è§„èŒƒï¼ˆéµå¾ªé˜¿é‡Œå·´å·´è§„èŒƒï¼‰
- **é»˜è®¤ä½¿ç”¨ `final`**ï¼šæ‰€æœ‰å˜é‡é»˜è®¤å£°æ˜ä¸º `final`
- **å‘½åçº¦å®š**ï¼š
  - å±€éƒ¨å˜é‡ï¼šå°é©¼å³°ï¼ˆ`userId`, `productName`ï¼‰
  - å¸¸é‡ï¼šå…¨å¤§å†™+ä¸‹åˆ’çº¿ï¼ˆ`MAX_RETRY_COUNT`ï¼‰
  - æˆå‘˜å˜é‡ï¼šå°é©¼å³°ï¼Œæ— å‰ç¼€ï¼ˆ`userService`ï¼‰
  - ç±»åï¼šå¤§é©¼å³°ï¼ˆ`UserController`, `ApiResponse`ï¼‰
- **é›†åˆç±»å‹**ï¼šä¼˜å…ˆä½¿ç”¨ä¸å¯å˜é›†åˆ `List.of()`, `Set.of()`, `Map.of()`

```java
// âœ… æ¨è
final String userId = "123";
final List<String> names = List.of("Alice", "Bob");
final Map<String, Object> config = Map.of("port", 8080);

// âŒ é¿å…
String userId = "123";  // ç¼ºå°‘final
ArrayList<String> names = new ArrayList<>();  // éçº¿ç¨‹å®‰å…¨
```

### æ–¹æ³•è®¾è®¡è§„èŒƒ
- **è¡Œæ•°é™åˆ¶**ï¼šæ–¹æ³•æœ€å¤§30è¡Œ
- **å‚æ•°é™åˆ¶**ï¼šæœ€å¤š3ä¸ªå‚æ•°ï¼Œè¶…è¿‡ä½¿ç”¨DTOå¯¹è±¡
- **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªæ–¹æ³•åªåšä¸€ä»¶äº‹
- **å¼‚æ­¥æ–¹æ³•**ï¼šä½¿ç”¨ `Future.await()` å¤„ç†å¼‚æ­¥æ“ä½œ

```java
// âœ… æ¨è
public User getUserById(final String id) {
    return Future.await(userRepository.findById(id));
}

// âŒ é¿å…ï¼šè¿”å› Future
public Future<User> getUserById(String id) {
    return userRepository.findById(id);
}
```

## ğŸ§µ JDK21è™šæ‹Ÿçº¿ç¨‹ä½¿ç”¨è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™
- **ç¦æ­¢è¿”å›Future**ï¼šæ‰€æœ‰æ–¹æ³•ç›´æ¥è¿”å›å…·ä½“ç±»å‹
- **ä½¿ç”¨Future.await()**ï¼šåœ¨æ–¹æ³•å†…éƒ¨å¤„ç†å¼‚æ­¥æ“ä½œ
- **å¼‚å¸¸ç›´æ¥æŠ›å‡º**ï¼šä¸è¦å°†å¼‚å¸¸åŒ…è£…åœ¨Futureä¸­

### æ ‡å‡†æ¨¡å¼
```java
// æ§åˆ¶å™¨å±‚
@GetMapping("/users/:id")
public User getUserById(@PathParam("id") String id) {
    return Future.await(userService.getUserById(id));
}

// æœåŠ¡å±‚
public List<User> getActiveUsers() {
    final List<User> users = Future.await(userRepository.findAll());
    return users.stream()
        .filter(User::isActive)
        .collect(Collectors.toList());
}

// å¼‚å¸¸å¤„ç†
public void processOrder(String orderId) {
    try {
        final Order order = Future.await(orderService.getOrder(orderId));
        Future.await(paymentService.processPayment(order));
    } catch (OrderNotFoundException e) {
        log.error("è®¢å•ä¸å­˜åœ¨: {}", orderId);
        throw e;
    }
}
```

## ğŸ—„ï¸ æ•°æ®åº“å®ä½“æ˜ å°„è§„èŒƒ

### ç±»å‹æ˜ å°„è¡¨
| MySQLç±»å‹ | Javaç±»å‹ | Rowè·å–æ–¹æ³• | ç¤ºä¾‹ |
|-----------|----------|-------------|------|
| BIGINT | Long | `getLong()` | `row.getLong("id")` |
| VARCHAR | String | `getString()` | `row.getString("username")` |
| DATETIME | LocalDateTime | `getLocalDateTime()` | `row.getLocalDateTime("created_at")` |
| DECIMAL | BigDecimal | `getBigDecimal()` | `row.getBigDecimal("price")` |
| BOOLEAN | Boolean | `getBoolean()` | `row.getBoolean("active")` |
| JSON | JsonObject | `getJson()` | `row.getJson("metadata")` |

### å®ä½“ç±»æ ‡å‡†ç»“æ„
```java
@Data
@Table("users")
public class User extends BaseEntity {
    @Id
    private Long id;

    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 50)
    private String username;

    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;

    @Column(value = "created_at", updatable = false)
    private LocalDateTime createdAt;

    // å¿…éœ€çš„fromRowæ–¹æ³•
    public static User fromRow(Row row) {
        if (row == null) return null;

        final User user = new User();
        user.setId(row.getLong("id"));
        user.setUsername(row.getString("username"));
        user.setEmail(row.getString("email"));
        user.setCreatedAt(row.getLocalDateTime("created_at"));
        return user;
    }
}
```

### å‘½åçº¦å®š
- **æ•°æ®åº“å­—æ®µ**ï¼šä¸‹åˆ’çº¿åˆ†éš”ï¼ˆ`created_at`, `user_name`ï¼‰
- **Javaå­—æ®µ**ï¼šé©¼å³°å‘½åï¼ˆ`createdAt`, `userName`ï¼‰
- **è‡ªåŠ¨æ˜ å°„**ï¼šç®€å•å­—æ®µæ— éœ€æ³¨è§£ï¼Œå¤æ‚æƒ…å†µä½¿ç”¨ `@Column`

## ğŸ“¡ APIå“åº”å¤„ç†è§„èŒƒ

### ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success",
  "data": { /* ä¸šåŠ¡æ•°æ® */ },
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### æ§åˆ¶å™¨æ ‡å‡†å†™æ³•
```java
@RestController
@RequestMapping("/api/users")
@Singleton
public class UserController {

    @Inject
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @GetMapping("/:id")
    public User getUserById(@PathParam("id") String id) {
        // ç›´æ¥è¿”å›ä¸šåŠ¡æ•°æ®ï¼Œè‡ªåŠ¨åŒ…è£…ä¸ºæ ‡å‡†å“åº”
        return Future.await(userService.getUserById(id));
    }

    @PostMapping("")
    public User createUser(@Valid @RequestBody CreateUserRequest request) {
        return Future.await(userService.createUser(request));
    }
}
```

### å¼‚å¸¸å¤„ç†
```java
// ä¸šåŠ¡å¼‚å¸¸
if (StringUtils.isBlank(id)) {
    throw new ValidationException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
}

// è‡ªå®šä¹‰å¼‚å¸¸
public class UserNotFoundException extends BusinessException {
    public UserNotFoundException(String userId) {
        super(404, "ç”¨æˆ·ä¸å­˜åœ¨: " + userId);
    }
}
```

## âœ… å‚æ•°éªŒè¯è§„èŒƒ

### Bean Validationæ³¨è§£
```java
public class CreateUserRequest {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´")
    private String username;

    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    private String email;

    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18å²")
    private Integer age;
}
```

### è·¯ç”±æ³¨è§£ä½¿ç”¨
```java
@GetMapping("/users")
public List<User> getUsers(
    @QueryParam("page") Integer page,
    @QueryParam("size") Integer size) {
    // æŸ¥è¯¢å‚æ•°è‡ªåŠ¨è§£æå’Œç±»å‹è½¬æ¢
}

@PostMapping("/users")
public User createUser(@Valid @RequestBody CreateUserRequest request) {
    // è‡ªåŠ¨éªŒè¯è¯·æ±‚ä½“
}
```

## ğŸ”§ ä»£ç é£æ ¼å·¥å…·

### Spotlessé…ç½®
- **æ ¼å¼åŒ–å‘½ä»¤**ï¼š`mvn spotless:apply`
- **æ£€æŸ¥å‘½ä»¤**ï¼š`mvn spotless:check`
- **Git Hook**ï¼šæäº¤å‰è‡ªåŠ¨æ ¼å¼åŒ–
- **IDEé›†æˆ**ï¼šä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–

### æäº¤æ¶ˆæ¯è§„èŒƒ
æ ¼å¼ï¼š`ç±»å‹(èŒƒå›´): æè¿°`

**æ”¯æŒçš„ç±»å‹**ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤Bug
- `docs`: æ–‡æ¡£å˜æ›´
- `style`: ä»£ç é£æ ¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºå·¥å…·å˜æ›´

**ç¤ºä¾‹**ï¼š
```
feat(user): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½
fix(auth): ä¿®å¤tokenè¿‡æœŸåˆ¤æ–­é€»è¾‘
docs(api): æ›´æ–°APIæ–‡æ¡£
```

## ğŸ“ æ—¥å¿—è®°å½•è§„èŒƒ

### æ—¥å¿—çº§åˆ«ä½¿ç”¨
| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹åœºæ™¯ |
|------|------|----------|
| ERROR | ç³»ç»Ÿé”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ã€æœªæ•è·å¼‚å¸¸ |
| WARN | è­¦å‘Šä¿¡æ¯ | é…ç½®ç¼ºå¤±ã€æ€§èƒ½è­¦å‘Š |
| INFO | é‡è¦ä¸šåŠ¡ä¿¡æ¯ | ç”¨æˆ·ç™»å½•ã€è®¢å•åˆ›å»º |
| DEBUG | è°ƒè¯•ä¿¡æ¯ | æ–¹æ³•è°ƒç”¨ã€å‚æ•°å€¼ |

### æ—¥å¿—è®°å½•ç¤ºä¾‹
```java
@Slf4j
public class UserService {
    public User createUser(CreateUserRequest request) {
        log.info("Creating user with username: {}", request.getUsername());

        try {
            User user = Future.await(userRepository.save(request.toUser()));
            log.info("User created successfully with ID: {}", user.getId());
            return user;
        } catch (Exception e) {
            log.error("Failed to create user: {}", request.getUsername(), e);
            throw e;
        }
    }
}
```

### æ•æ„Ÿä¿¡æ¯å¤„ç†
```java
// âŒ é¿å…ï¼šè®°å½•æ•æ„Ÿä¿¡æ¯
log.info("User login: username={}, password={}", username, password);

// âœ… æ¨èï¼šè„±æ•å¤„ç†
log.info("User login: username={}, password=***", username);
```

## ğŸš¨ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

### å¼‚å¸¸åˆ†å±‚
```java
// ç³»ç»Ÿå¼‚å¸¸ - æŠ€æœ¯é”™è¯¯ï¼Œè¿”å›500
public class SystemException extends RuntimeException {
    public SystemException(String message, Throwable cause) {
        super(message, cause);
    }
}

// ä¸šåŠ¡å¼‚å¸¸ - ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼Œè¿”å›400-499
public class BusinessException extends RuntimeException {
    private final int code;

    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }
}

// éªŒè¯å¼‚å¸¸ - å‚æ•°éªŒè¯å¤±è´¥ï¼Œè¿”å›400
public class ValidationException extends BusinessException {
    public ValidationException(String message) {
        super(400, message);
    }
}
```

### å¼‚å¸¸ä½¿ç”¨ç¤ºä¾‹
```java
public User getUserById(String id) {
    if (StringUtils.isBlank(id)) {
        throw new ValidationException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
    }

    User user = Future.await(userRepository.findById(id));
    if (user == null) {
        throw new BusinessException(404, "ç”¨æˆ·ä¸å­˜åœ¨: " + id);
    }

    return user;
}
```

## ğŸ“‹ ä»£ç å®¡æŸ¥æ¸…å•

### å¿…é¡»æ£€æŸ¥é¡¹
- [ ] æ‰€æœ‰å˜é‡æ˜¯å¦ä½¿ç”¨ `final` å£°æ˜
- [ ] æ–¹æ³•æ˜¯å¦ç›´æ¥è¿”å›å…·ä½“ç±»å‹ï¼ˆéFutureï¼‰
- [ ] æ˜¯å¦æ­£ç¡®ä½¿ç”¨ `Future.await()`
- [ ] å®ä½“ç±»æ˜¯å¦åŒ…å« `fromRow` æ–¹æ³•
- [ ] æ˜¯å¦æ·»åŠ å¿…è¦çš„éªŒè¯æ³¨è§£
- [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦è§„èŒƒ
- [ ] æ—¥å¿—è®°å½•æ˜¯å¦å®Œæ•´ä¸”ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- [ ] æäº¤æ¶ˆæ¯æ˜¯å¦ç¬¦åˆè§„èŒƒ

### æ€§èƒ½æ£€æŸ¥é¡¹
- [ ] æ˜¯å¦é¿å…åœ¨å¾ªç¯ä¸­è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
- [ ] æ˜¯å¦ä½¿ç”¨åˆé€‚çš„é›†åˆç±»å‹
- [ ] æ˜¯å¦æ­£ç¡®å¤„ç†å¤§æ•°æ®é‡æ“ä½œ
- [ ] æ˜¯å¦é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
